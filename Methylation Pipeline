# 1. Download the latest sup_modbases 5mC CpG model for Dorado

dorado download --model dna_r10.4.1_e8.2_400bps_sup@v5.2.0_5mCG_5hmCG@v1 --models-directory /home/craig/dorado_models


# 2. Basecall + methylation-aware signal moves with Dorado

dorado basecaller dna_r10.4.1_e8.2_400bps_sup@v5.2.0_5mCG_5hmCG@v1 /mnt/e/Methylation_Pipeline/Pod_5/41031_1 --models-directory /home/craig/dorado_models/ --emit-moves --emit-fastq > dorado_calls.bam


# 3. Sort & index your basecalled BAM
samtools sort -@8 -o dorado_calls.sorted.bam dorado_calls.bam
samtools index -@8 dorado_calls.sorted.bam

# 4. Activate your methylation env & run Remora
conda activate methylation    # or: source ~/remora-venv/bin/activate
remora infer from_pod5_and_bam \
  /path/to/pod5_dir \
  dorado_calls.sorted.bam \
  --model dna_r10.4.1_e8.2_sup_5mCG@v1.pt \
  --reference /path/to/hg38.fa \
  --reference-anchored \
  --out-file dorado_remora.bam \
  --device 0
conda deactivate

# 5. Aggregate genome-wide 5mC frequencies with Megalodon extras
conda activate methylation
megalodon_extras aggregate \
  --input dorado_remora.bam \
  --output-site-frequency all_sites.tsv \
  --mod-bases m \
  --motif CG




